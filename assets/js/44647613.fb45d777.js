"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[679],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),k=p(a),m=r,h=k["".concat(s,".").concat(m)]||k[m]||c[m]||o;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=k;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},1853:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},assets:function(){return u},toc:function(){return c},default:function(){return m}});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),i=["components"],l={slug:"introducing-skyhook",title:"Introducing Skyhook",tags:["skyhook","redis","aerospike"]},s=void 0,p={permalink:"/skyhook/blog/introducing-skyhook",editUrl:"https://github.com/aerospike/skyhook/edit/main/website/blog/blog/2021-08-30-introducing-skyhook.md",source:"@site/blog/2021-08-30-introducing-skyhook.md",title:"Introducing Skyhook",description:"https://dev.to/aerospike/skyhook-a-redis-compatible-interface-to-aerospike-database-4hjj",date:"2021-08-30T00:00:00.000Z",formattedDate:"August 30, 2021",tags:[{label:"skyhook",permalink:"/skyhook/blog/tags/skyhook"},{label:"redis",permalink:"/skyhook/blog/tags/redis"},{label:"aerospike",permalink:"/skyhook/blog/tags/aerospike"}],readingTime:4.32,truncated:!1,authors:[]},u={authorsImageUrls:[]},c=[{value:"Skyhook to the rescue",id:"skyhook-to-the-rescue",children:[],level:2},{value:"Technical details",id:"technical-details",children:[],level:2},{value:"Installation and configuration",id:"installation-and-configuration",children:[],level:2},{value:"Benchmarking",id:"benchmarking",children:[],level:2},{value:"Summary",id:"summary",children:[],level:2}],k={toc:c};function m(e){var t=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},k,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},(0,o.kt)("a",{parentName:"em",href:"https://dev.to/aerospike/skyhook-a-redis-compatible-interface-to-aerospike-database-4hjj"},"https://dev.to/aerospike/skyhook-a-redis-compatible-interface-to-aerospike-database-4hjj")))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.aerospike.com/"},"Aerospike")," is a highly available and scalable NoSQL distributed database used in production to provide blazingly fast performance at Petabyte scale. Production deployments of Aerospike are almost always serving their data from NVMe drives, though it\u2019s possible to run namespaces in memory."),(0,o.kt)("p",null,"Redis is a well loved key-value data store that is widely used by developers, which was designed to run single node (single-threaded originally) and in-memory.\nThis article might be interesting to developers who are using ",(0,o.kt)("a",{parentName:"p",href:"https://redis.io/"},"Redis")," and looking for more scalable and highly available alternatives, or maybe already have some applications running on Aerospike."),(0,o.kt)("p",null,"Migrating to a different technology is always a challenging process. You need to train engineers, rewrite the codebase, and set up a production cluster to take over. Using ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/aerospike/skyhook"},"Skyhook"),", you can move applications to Aerospike first, then come back to rewrite them as Aerospike native, or if you\u2019re satisfied with their performance, keep them as they are.\nOr maybe you\u2019re looking to expose your Aerospike data to external Redis-based applications? We would love to hear how you would use this project."),(0,o.kt)("h2",{id:"skyhook-to-the-rescue"},"Skyhook to the rescue"),(0,o.kt)("p",null,"We, as a company, observed this need and came up with the highly performant bridge service, which acts as a fully-fledged (with commands support limitation) Redis server, bridging the clients\u2019 commands to Aerospike clusters."),(0,o.kt)("h2",{id:"technical-details"},"Technical details"),(0,o.kt)("p",null,"Skyhook is a standalone server application written in Kotlin, which projects Redis protocol commands to an Aerospike cluster using the Aerospike Java client under the hood. The server supports a single namespace and set configuration, where the incoming commands will be applied. This project uses ",(0,o.kt)("a",{parentName:"p",href:"https://netty.io/"},"Netty")," as a non-blocking I/O client-server framework."),(0,o.kt)("p",null,"Netty, is a highly performant JVM asynchronous event-driven network application framework. Its customizable thread model and native transport support forge an incredibly performant network communication layer."),(0,o.kt)("p",null,"What\u2019s left is to translate Redis commands to Aerospike commands, and here come the async capabilities of the Aerospike Java Client."),(0,o.kt)("h2",{id:"installation-and-configuration"},"Installation and configuration"),(0,o.kt)("p",null,"You will need JDK8 and an Aerospike Server version >= 4.9 because Skyhook uses the new scan capabilities which are available starting from that version."),(0,o.kt)("p",null,"Clone ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/aerospike/skyhook"},"aerospike/skyhook")," or grab a prebuilt executable JAR from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/aerospike/skyhook/releases"},"releases")," to get started."),(0,o.kt)("p",null,"To build the service from the sources:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"./gradlew clean build\n")),(0,o.kt)("p",null,"This command will build an executable JAR file."),(0,o.kt)("p",null,"Skyhook is configured using a configuration file, and it\u2019s in YAML format. You will need to specify it using the ",(0,o.kt)("inlineCode",{parentName:"p"},"-f")," flag."),(0,o.kt)("p",null,"To run the server:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"java -jar skyhook-[version]-all.jar -f config/server.yml\n")),(0,o.kt)("p",null,"An example configuration file can be found in the config folder under the project repository."),(0,o.kt)("p",null,"Here are the current configuration properties available."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Property name"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"),(0,o.kt)("th",{parentName:"tr",align:null},"Default value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"hostList"),(0,o.kt)("td",{parentName:"tr",align:null},"The host list to seed the Aerospike cluster."),(0,o.kt)("td",{parentName:"tr",align:null},"localhost:3000")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"namespace"),(0,o.kt)("td",{parentName:"tr",align:null},"The Aerospike namespace."),(0,o.kt)("td",{parentName:"tr",align:null},"test")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"set"),(0,o.kt)("td",{parentName:"tr",align:null},"The Aerospike set name."),(0,o.kt)("td",{parentName:"tr",align:null},"redis")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"bin"),(0,o.kt)("td",{parentName:"tr",align:null},"The Aerospike bin name to set values."),(0,o.kt)("td",{parentName:"tr",align:null},"b")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"redisPort"),(0,o.kt)("td",{parentName:"tr",align:null},"The server port to bind to."),(0,o.kt)("td",{parentName:"tr",align:null},"6379")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"workerThreads",(0,o.kt)("sup",null,"1")),(0,o.kt)("td",{parentName:"tr",align:null},"The Netty worker group size."),(0,o.kt)("td",{parentName:"tr",align:null},"number of available cores")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"bossThreads"),(0,o.kt)("td",{parentName:"tr",align:null},"The Netty acceptor group size."),(0,o.kt)("td",{parentName:"tr",align:null},"2")))),(0,o.kt)("sup",null,"1")," `workerThreads` property is used to configure the size of the Aerospike Java Client EventLoops as well.",(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"workerThreads")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"bossThreads")," are the Netty thread pool sizes and can be easily fine-tuned for optimal performance.\nAfter the server is up and running, any Redis client can connect to it as if it were a regular Redis server."),(0,o.kt)("p",null,"For the test purposes you can use redis-cli or even the nc (or netcat) utility:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'echo "GET key1\\r\\n" | nc localhost 6379\n')),(0,o.kt)("h2",{id:"benchmarking"},"Benchmarking"),(0,o.kt)("p",null,"From the very beginning, the project was built with an attention to performance, and the results speak for themselves."),(0,o.kt)("p",null,"Running this Redis benchmark:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"redis-benchmark -t set -r 100000 -n 1000000\n")),(0,o.kt)("p",null,"We had the following results on local Skyhook with a single-node default configuration Aerospike cluster on Docker:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},"Summary:"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"throughput summary: 13453.88 requests per second"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"latency summary (msec):"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"avg       min       p50       p95       p99    max"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"3.627     0.864     3.263     5.583     7.463  1012.223"))),(0,o.kt)("p",null,"While those were the results for the Redis node running on Docker:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},"Summary:"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"throughput summary: 14967.15 requests per second"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"latency summary (msec):"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"avg       min       p50       p95       p99    max"),(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("em",{parentName:"p"},"3.275     0.608     2.935     5.087     6.679  1006.591"))),(0,o.kt)("p",null,"You can see that they are really close. More than that, we can multiply the number of the Skyhook nodes and significantly improve performance working with the same aerospike cluster. For instance, you can use the Round-robin DNS or any popular load balancer like HAProxy. This will not require any specific configuration since Skyhook is completely stateless."),(0,o.kt)("h2",{id:"summary"},"Summary"),(0,o.kt)("p",null,"The project is constantly evolving, having more and more commands being supported. You can find the coverage of the supported Redis commands in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/aerospike/skyhook"},"repo readme"),"."),(0,o.kt)("p",null,"It will be really great to hear from you about the experience of using it. Also, your contributions to the project are very welcome."),(0,o.kt)("p",null,"If you encounter a bug, please report it or ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/aerospike/skyhook/issues"},"open an issue")," stating the commands you would like to be supported."))}m.isMDXComponent=!0}}]);